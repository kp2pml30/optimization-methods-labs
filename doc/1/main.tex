\documentclass[russian, english]{article}

\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{pgfplots}
\usepackage{graphicx}
\usepackage{csvsimple}
\usepackage{hyperref}

\inputencoding{utf8}
\def\code#1{\texttt{#1}}

\begin{document}

\begin{titlepage}
\centering
	{\scshape\LARGE Методы оптимизации \par}
	\vspace{1cm}
	{\scshape\Large Лабораторная работа №1\par}
	\vspace{2cm}
	{\Large\itshape Дмитрий Проценко M3234 \par
	Кирилл Прокопенко M3236 \par
	Николай Холявин M3238 \par}
	\vfill
	ИТМО y2019
	\vfill
	{\large \today\par}
\end{titlepage}

\tableofcontents
\newpage

\section{Задание}
Найти минимумы данной функции при помощи методов оптимизации:
\begin{itemize}
\item дихотомии
\item золотого сечения
\item Фибоначчи
\item парабол
\item комбинированный метод Брента
\end{itemize}

\section{Функция}
\subsection{f}
$f(x)=x^4-\frac{3}{2}\arctan{x}$

\subsection{график}
\par
\begin{tikzpicture}
\begin{axis}[
	xlabel = {$x$},
	ylabel = {$f$},
	minor tick num = 2,
]
\addplot[blue, domain=-1.5:1.5] {x^4 - 3/2 * atan(rad(x))};
\end{axis}
\end{tikzpicture}

\subsection{аналитическое решение}

\begin{gather*}
f'(x) = 4x^3 - \frac{3}{2(1+x^2)} \\
f' = 0 \Leftrightarrow 8x^3(1+x^2)-3 = 0 \Leftrightarrow 8x^5+8x^3-3=0 \\
f'' = 40x^4 + 24x^2 = x^2(40x^2 + 24) \ge 0 \\
f'(0.642636) \approx 0
\end{gather*}
Производная монотонно возрастает, значит этот корень является минимумом.
Данное уравнение не решается аналитически.

\section{Таблицы}

\begin{itemize}
\item Дихотомия\par
	\csvautotabular[separator=tab]{dichotomyRange.csv}
\item Золотое сечение\par
	\csvautotabular[separator=tab]{golden-sectionRange.csv}
\item Фибоначчи\par
	\csvautotabular[separator=tab]{fibonacciRange.csv}
\item Парабол\par
	\csvautotabular[separator=tab]{parabolicRange.csv}
	\par
	Метод парабол выделился: он не меняет правую границу, из-за чего выглядит как худший результат, хотя это не так.
\end{itemize}

\pgfplotstableread{ratios.csv}{\ratiosCsv}
\begin{tikzpicture}[trim axis left]
	\begin{axis}[
		scale only axis,
		width=\textwidth,
		legend style={at={(0.5,-0.2)},anchor=north},
		xlabel = {итерация},
		ylabel = {$\log ratio$},
	]
	\addplot table [x={i}, y={dichotomy}] {\ratiosCsv};
	\addlegendentry{Дихотомия}
	\addplot table [x={i}, y={golden-section}] {\ratiosCsv};
	\addlegendentry{Золотое сечение}
	\addplot table [x={i}, y={fibonacci}] {\ratiosCsv};
	\addlegendentry{Фибоначчи}
	\addplot table [x={i}, y={parabolic}] {\ratiosCsv};
	\addlegendentry{Парабол}
	\end{axis}
\end{tikzpicture}


\section{Графики}
\subsection{Количество вычислений от $\varepsilon$}

\pgfplotstableread{epsilonToComplexity.csv}{\epsPlot}
\begin{tikzpicture}[trim axis left]
	\begin{axis}[
		scale only axis,
		width=\textwidth,
		legend style={at={(0.5,-0.2)},anchor=north},
		xlabel = {$\log \varepsilon$},
		ylabel = {$C$},
	]
	\addplot table [x={epsilon}, y={dichotomy}] {\epsPlot};
	\addlegendentry{Дихотомия}
	\addplot table [x={epsilon}, y={golden_section}] {\epsPlot};
	\addlegendentry{Золотое сечение}
	\addplot table [x={epsilon}, y={fibonacci}] {\epsPlot};
	\addlegendentry{Фибоначчи}
	\addplot table [x={epsilon}, y={parabolic}] {\epsPlot};
	\addlegendentry{Парабол}
	\end{axis}
\end{tikzpicture}
\par
Можно заметить, что графики \textbf{визуально} хорошо аппроксимируются линейным.
Помимо этого метод парабол хорошо аппроксимирует дунную функцию за малое число итераций, из-за чего можно видеть горизонтальную линию.

\section{Вывод}

\section{Многомодальные функции}
Для функций, имеющих несколько минимумов, есть шанс что метод найдет локальный минимум а не глобальный.\par

\def\FunctionF(#1){(#1)^4/2520*403 - (#1)^3/60*181 + (#1)^2/360*6287 - (#1)/28*921 + 5}

\begin{tikzpicture}
\begin{axis}[
	xlabel = {$x$},
	ylabel = {$f$},
	minor tick num = 1,
]
	\addplot[blue, domain=0:10] {\FunctionF(x)};
	
	\newcommand*{\SpecialX}{4.0}
	\pgfmathsetmacro{\specialY}{\FunctionF(\SpecialX)}
	\addplot[mark=*] coordinates {(\SpecialX,\specialY)} node[pin=150:{$1$}]{} ;
	
	\renewcommand*{\SpecialX}{5.0}
	\pgfmathsetmacro{\specialY}{\FunctionF(\SpecialX)}
	\addplot[mark=*] coordinates {(\SpecialX,\specialY)} node[pin=150:{$2$}]{} ;

\end{axis}
\end{tikzpicture}
\par

Дихотомия могла посмотреть на точки вблизи $1$ и сузить интервал до $[0;4]$, пропустив глобальный максимум.
\par
{\color{red} TODO} 
Или, методы опирающиеся на несколько точек, могут посмотреть в $1$ и $2$ и получить неверное представление: функция на этом участке не монотонна и не имеет минимума, значит результат не дает никакой информации.

\newpage
\appendix
\section{код}
\subsection{архитектура}
Есть \code{Approximator}, который возвращает корутину, которая аппроксимирует данную функцию, на каждой итерации стягивая отрезок поиска. Данный подход позволяет иметь скорость выполнения как у нативного кода, сохраняет гарантии типов за счет c++ концептов, позволяет при необходимости использовать type-erasure и получить гибкость наследования, пожертвовав производительностью.

\subsection{ссылка}
\url{https://github.com/kp2pml30/optimization-methods-labs}

\end{document}

